<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - SportX</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #00d2ff; --dark: #0f172a; --glass: rgba(255, 255, 255, 0.05); --border: rgba(255, 255, 255, 0.1); }
        body { font-family: 'Poppins', sans-serif; background: #0f172a; color: white; margin: 0; padding: 20px; box-sizing: border-box; }
        .checkout-container { max-width: 500px; margin: 0 auto; }
        .header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
        .header h2 { font-size: 20px; margin: 0; color: var(--primary); }

        /* প্রোডাক্ট সামারি */
        .product-summary { 
            background: var(--glass); border: 1px solid var(--border); border-radius: 20px; 
            padding: 15px; margin-bottom: 20px; display: flex; align-items: center; gap: 15px;
        }
        .product-summary img { 
            width: 80px; height: 80px; border-radius: 12px; object-fit: cover; background: white; 
            border: 2px solid var(--primary);
        }
        .p-info-text b { font-size: 16px; color: white; display: block; margin-bottom: 3px; }
        .size-badge { background: rgba(0, 210, 255, 0.2); padding: 2px 8px; border-radius: 5px; color: var(--primary); font-size: 12px; }

        .section-card { background: var(--glass); border: 1px solid var(--border); border-radius: 20px; padding: 20px; margin-bottom: 20px; }
        label { font-size: 13px; color: #94a3b8; display: block; margin: 10px 0 5px 5px; }
        input, select { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid var(--border); background: #1e293b; color: white; box-sizing: border-box; outline: none; font-size: 14px; margin-bottom: 10px;}
        input:focus { border-color: var(--primary); }
        
        .method-container { display: flex; gap: 10px; margin-top: 10px; }
        .method-card { flex: 1; background: #1e293b; border: 1px solid var(--border); padding: 15px 10px; border-radius: 12px; text-align: center; cursor: pointer; transition: 0.3s; }
        .method-card img { width: 45px; height: 45px; object-fit: contain; margin-bottom: 5px; }
        .method-card.selected { border-color: var(--primary); background: rgba(0, 210, 255, 0.1); }

        #numberDisplay { display: none; background: #0f172a; border: 1px dashed var(--primary); padding: 15px; border-radius: 12px; margin-top: 15px; text-align: center; }
        #payNum { font-size: 18px; color: var(--primary); letter-spacing: 1px; }

        .price-summary { border-top: 1px dashed var(--border); margin-top: 15px; padding-top: 15px; }
        .price-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; }
        .total-row { font-size: 18px; font-weight: bold; color: var(--primary); border-top: 1px solid var(--border); padding-top: 10px; }

        .confirm-btn { width: 100%; padding: 15px; background: var(--primary); border: none; border-radius: 15px; font-weight: bold; color: var(--dark); cursor: pointer; font-size: 16px; margin-top: 20px; }
    </style>
</head>
<body>

<div class="checkout-container">
    <div class="header">
        <i class="fa fa-arrow-left" onclick="history.back()" style="cursor:pointer"></i>
        <h2>অর্ডার কনফার্ম করুন</h2>
    </div>

    <div class="product-summary">
        <img id="sumImg" src="" alt="Product Image">
        <div class="p-info-text">
            <b id="sumTitle">লোড হচ্ছে...</b>
            <span>সাইজ: <span id="sumSize" class="size-badge">N/A</span></span>
        </div>
    </div>

    <div class="section-card">
        <label>আপনার নাম</label>
        <input type="text" id="uName" placeholder="নাম লিখুন">
        
        <label>মোবাইল নম্বর</label>
        <input type="tel" id="uPhone" placeholder="017XXXXXXXX">

        <label>জেলা সিলেক্ট করুন</label>
        <select id="uDistrict">
            <option value="">জেলা সিলেক্ট করুন</option>
        </select>

        <label>থানা / উপজেলা / সিটি</label>
        <select id="uAreaSelect">
            <option value="">আগে জেলা সিলেক্ট করুন</option>
        </select>

        <label>বিস্তারিত ঠিকানা (রোড/বাসা নং)</label>
        <input type="text" id="uFullAddress" placeholder="যেমন: বাসা নং ১২, রোড ৫">
    </div>

    <div class="section-card">
        <label>ডেলিভারি এরিয়া</label>
        <select id="uDeliveryArea">
            <option value="70">ঢাকা সিটি (৳৭০)</option>
            <option value="100">সাব ঢাকা (৳১০০)</option>
            <option value="130">ঢাকার বাইরে (৳১৩০)</option>
        </select>

        <label>পেমেন্ট মেথড</label>
        <div class="method-container">
            <div class="method-card" id="bkashBtn">
                <img src="https://www.logo.wine/a/logo/BKash/BKash-bKash-Logo.wine.svg">
                <span>bKash</span>
            </div>
            <div class="method-card" id="nagadBtn">
                <img src="https://www.logo.wine/a/logo/Nagad/Nagad-Logo.wine.svg">
                <span>Nagad</span>
            </div>
        </div>

        <div id="numberDisplay">
            <span id="methodLabel">টাকা পাঠান এই নম্বরে:</span><br>
            <b id="payNum"></b><br>
            <small>নম্বর কপি করতে ক্লিক করুন</small>
        </div>

        <input type="text" id="trxID" placeholder="Transaction ID (TrxID)" style="margin-top:15px; display:none;">

        <div class="price-summary">
            <div class="price-row"><span>প্রোডাক্ট প্রাইস:</span> <span id="pPriceText">0 ৳</span></div>
            <div class="price-row"><span>ডেলিভারি চার্জ:</span> <span id="dChargeText">70 ৳</span></div>
            <div class="price-row total-row"><span>সর্বমোট:</span> <span id="totalAmount">0 ৳</span></div>
        </div>
    </div>

    <button class="confirm-btn" id="submitOrder">অর্ডার নিশ্চিত করুন</button>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getDatabase, ref, onValue, push, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCu8lgGs3Q-qLeedhngQAVXtt8BHOAlWDg",
        authDomain: "ms-sp-97f78.firebaseapp.com",
        databaseURL: "https://ms-sp-97f78-default-rtdb.firebaseio.com",
        projectId: "ms-sp-97f78",
        storageBucket: "ms-sp-97f78.appspot.com",
        appId: "1:880638162029:web:b99af5b5518b3e16a13b64"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    // ডেটাবেস থেকে ৬৫টি জেলার ডেটা
    const areaData = {
        "Bagerhat": ["Bagerhat Sadar (বাগেরহাট সদর)", "Chitalmari (চিতলমারী)", "Fakirhat (ফকিরহাট)", "Kachua (কচুয়া)", "Mollahat (মোল্লাহাট)", "Mongla (মোংলা)", "Morrelgamj (মোড়েলগঞ্জ)", "Rampal (রামপাল)", "Sarankhola (শরণখোলা)"],
        "Bandarban": ["Bandarban Sadar (বান্দরবান সদর)", "Ali kadam (আলীকদম)", "Lama (লামা)", "Naikhongchari (নাইক্ষ্যংছড়ি)", "Rowangchhari (রোয়াংছড়ি)", "Ruma (রুমা)", "Thanchi (থানচি)"],
        "Barguna": ["Barguna Sadar (বরগুনা সদর)", "Amtali (আমতলী)", "Bamna (বামনা)", "Betagi (বেতাগী)", "Patharghata (পাথরঘাটা)", "Taltali (তালতলী)"],
        "Barishal": ["Barishal Sadar (বরিশাল সদর)", "Agailihara (আগৈলঝাড়া)", "Babuganj (বাবুগঞ্জ)", "Bekerganj (বাকেরগঞ্জ)", "Banaripara (বানারীপাড়া)", "Gouronadi (গৌরনদী)", "Hizla (হিজলা)", "Mehendiganj (মেহেন্দিগঞ্জ)", "Muladi (মুলাদী)", "Wazirpur (উজিরপুর)"],
        "Bhola": ["Bhola Sadar (ভোলা সদর)", "Borhanuddin (বোরহানউদ্দিন)", "Char Fasson (চরফ্যাশন)", "Daulatkhan (দৌলতখান)", "Lalmohan (লালমোহন)", "Manpura (মনপুরা)", "Tazumuddin (তজুমদ্দিন)"],
        "Bogra": ["Bogura sadar (বগুড়া সদর)", "Alamdighi (আদমদীঘি)", "Dhunat (ধুনট)", "Dhupcgancia (দুপচাঁচিয়া)", "Gabtoli (গাবতলী)", "Kahaloo (কাহালু)", "Nandigram (নন্দীগ্রাম)", "Saraikandi (সারিয়াকান্দি)", "Shajahanpur (শাহজাহানপুর)", "Sherpur (শেরপুর)", "Shibganj (শিবগঞ্জ)", "Sanatoli (সোনাতলা)"],
        "Brahmanbaria": ["Brahmanbaria Sadar (ব্রাহ্মণবাড়িয়া সদর)", "Akhaura (আখাউড়া)", "Ashuganj (আশুগঞ্জ)", "Bancharampur (বাঞ্ছারামপুর)", "Bijoynagar (বিজয়নগর)", "Kasba (কসবা)", "Nabinagar (নবীনগর)", "Nasirnagar (নাসিরনগর)", "Sarail (সরাইল)"],
        "Chandpur": ["Chandpur Sadar (চাঁদপুর সদর)", "Faridganj (ফরিদগঞ্জ)", "Haimchar (হাইমচর)", "Hajiganj (হাজীগঞ্জ)", "Kachua (কচুয়া)", "Matlab North (মতলব উত্তর)", "Matlab South (মতলব দক্ষিণ)", "Shahrasti (শাহরাস্তি)"],
        "Chapainawabganj": ["Chapainawabganj sadar (চাঁপাইনবাবগঞ্জ সদর)", "Bholahat (ভোলাহাট)", "Gomastapur (গোমস্তাপুর)", "Nachole (নাচোল)", "Shibganj (শিবগঞ্জ)"],
        "Chittagong": ["Chittagong City (চট্টগ্রাম সিটি)", "Anwara (আনোয়ারা)", "Banskhali (বাঁশখালী)", "Boalkhali (বোয়ালখালী)", "Chandanaish (চন্দনাইশ)", "Fatikchori (ফটিকছড়ি)", "Hathazari (হাটহাজারী)", "Lohangara (লোহাগাড়া)", "Mirsharai (মিরসরাই)", "Patiya (পটিয়া)", "Rangunia (রাঙ্গুনিয়া)", "Raozan (রাউজান)", "Sandwip (সন্দ্বীপ)", "Satkania (সাতকানিয়া)", "Sitakunda (সীতাকুণ্ড)"],
        "Cox's Bazar": ["Cox's Bazar Sadar (কক্সবাজার সদর)", "Chakaria (চকুরিয়া)", "Kutubdia (কুতুবদিয়া)", "Moheskhali (মহেশখালী)", "Pekua (পেকুয়া)", "Ramu (রামু)", "Teknaf (টেকনাফ)", "Ukhiya (উখিয়া)"],
        "Cumilla": ["Cumilla Sadar (কুমিল্লা সদর)", "Barura (বরুড়া)", "Brahmanpara (ব্রাহ্মণপাড়া)", "Burichang (বুড়িচং)", "Chandina (চান্দিনা)", "Chauddagram (চৌদ্দগ্রাম)", "Daudkandi (দাউদকান্দি)", "Debidwar (দেবিদ্বার)", "Homna (হোমনা)", "Laksam (লাকসাম)", "Muradnagar (মুরাদনগর)", "Nangalkot (নাঙ্গলকোট)"],
        "Dhaka City": ["Dhaka North (ঢাকা উত্তর)", "Dhaka South (ঢাকা দক্ষিণ)", "Mirpur (মিরপুর)", "Uttara (উত্তরা)", "Gulshan (গুলশান)", "Dhanmondi (ধানমন্ডি)", "Badda (বাড্ডা)", "Motijheel (মতিঝিল)", "Jatrabari (যাত্রাবাড়ী)"],
        "Dhaka Sub": ["Savar (সাভার)", "Ashulia (আশুলিয়া)", "Keraniganj (কেরানীগঞ্জ)", "Dhamrai (ধামরাই)", "Nawabganj (নবাবগঞ্জ)", "Dohar (দোহার)"],
        "Dinajpur": ["Dinajpur Sadar (দিনাজপুর সদর)", "Birampur (বিরামপুর)", "Birganj (বীরগঞ্জ)", "Chirirbandar (চিরিরবন্দর)", "Phulbari (ফুলবাড়ী)", "Ghoraghat (ঘোড়াঘাট)", "Hakimpur (হাকিমপুর)", "Parbatipur (পার্বতীপুর)"],
        "Faridpur": ["Faridpur Sadar (ফরিদপুর সদর)", "Alfadanga (আলফাডাঙ্গা)", "Bhanga (ভাঙ্গা)", "Boalmari (বোয়ালমারী)", "Madhukhali (মধুখালী)", "Nagarkanda (নগরকান্দা)"],
        "Feni": ["Feni Sadar (ফেনী সদর)", "Chhagalnaiya (ছাগলনাইয়া)", "Daganbhuiyan (দাগনভূঞা)", "Parshuram (পরশুরাম)", "Sonagazi (সোনাগাজী)"],
        "Gaibandha": ["Gaibandha Sadar (গাইবান্ধা সদর)", "Gobindaganj (গোবিন্দগঞ্জ)", "Palashbari (পলাশবাড়ী)", "Sundarganj (সুন্দরগঞ্জ)", "Saghata (সাঘাটা)"],
        "Gazipur": ["Gazipur Sadar (গাজীপুর সদর)", "Kaliakair (কালিয়াকৈর)", "Kaliganj (কালীগঞ্জ)", "Kapasia (কাপাসিয়া)", "Sreepur (শ্রীপুর)", "Tongi (টঙ্গী)"],
        "Gopalganj": ["Gopalganj Sadar (গোপালগঞ্জ সদর)", "Kashiani (কাশিয়ানী)", "Kotalipara (কোটালীপাড়া)", "Muksudpur (মুকসুদপুর)", "Tungipara (টুঙ্গিপাড়া)"],
        "Habiganj": ["Habiganj Sadar (হবিগঞ্জ সদর)", "Bahubal (বাহুবল)", "Baniyachong (বানিয়াচং)", "Chunarughat (চুনারুঘাট)", "Madhabpur (মাধবপুর)", "Nabiganj (নবীগঞ্জ)"],
        "Jamalpur": ["Jamalpur Sadar (জামালপুর সদর)", "Bakshiganj (বকশীগঞ্জ)", "Dewanganj (দেওয়ানগঞ্জ)", "Islampur (ইসলামপুর)", "Madarganj (মাদারগঞ্জ)", "Sarishabari (সরিষাবাড়ী)"],
        "Jashore": ["Jashore Sadar (যশোর সদর)", "Abhaynagar (অভয়নগর)", "Chougacha (চৌগাছা)", "Jhikargacha (ঝিকরগাছা)", "Keshabpur (কেশবপুর)", "Manirampur (মণিরামপুর)", "Sharsha (শার্শা)"],
        "Jhalokati": ["Jhalokati Sadar (ঝালকাঠি সদর)", "Kathalia (কাঁঠালিয়া)", "Nalchity (নলছিটি)", "Rajapur (রাজাপুর)"],
        "Jhenaidah": ["Jhenaidah Sadar (ঝিনাইদহ সদর)", "Harinakunda (হরিণাকুণ্ডু)", "Kaliganj (কালীগঞ্জ)", "Kotchandpur (কোটচাঁদপুর)", "Maheshpur (মহেশপুর)", "Shailkupa (শৈলকুপা)"],
        "Joypurhat": ["Joypurhat Sadar (জয়পুরহাট সদর)", "Akkelpur (আক্কেলপুর)", "Kalai (কালাই)", "Khetlal (ক্ষেতলাল)", "Panchbibi (পাঁচবিবি)"],
        "Khagrachari": ["Khagrachari Sadar (খাগড়াছড়ি সদর)", "Dighinala (দীঘিনালা)", "Matiranga (মাটিরাঙ্গা)", "Ramgarh (রামগড়)", "Panchari (পানছড়ি)"],
        "Khulna": ["Khulna City (খুলনা সিটি)", "Dacope (দাকোপ)", "Dumuria (ডুমুরিয়া)", "Paikgacha (পাইকগাছা)", "Phultala (ফুলতলা)", "Rupsha (রূপসা)"],
        "Kishoreganj": ["Kishoreganj Sadar (কিশোরগঞ্জ সদর)", "Bhairab (ভৈরব)", "Bajitpur (বাজিতপুর)", "Katiadi (কটিয়াদী)", "Kuliarchar (কুলিয়ারচর)"],
        "Kurigram": ["Kurigram Sadar (কুড়িগ্রাম সদর)", "Bhurungamari (ভুরুঙ্গামারী)", "Nageshwari (নাগেশ্বরী)", "Rajarhat (রাজারহাট)", "Ulipur (উলিপুর)"],
        "Kushtia": ["Kushtia Sadar (কুষ্টিয়া সদর)", "Bheramara (ভেড়ামারা)", "Kumarkhali (কুমারখালী)", "Mirpur (মিরপুর)", "Daulatpur (দৌলতপুর)"],
        "Lalmonirhat": ["Lalmonirhat Sadar (লালমনিরহাট সদর)", "Aditmari (আদিতমারী)", "Hatibandha (হাতীবান্ধা)", "Patgram (পাটগ্রাম)"],
        "Laxmipur": ["Laxmipur Sadar (লক্ষ্মীপুর সদর)", "Raipur (রায়পুর)", "Ramganj (রামগঞ্জ)", "Ramgati (রামগতি)"],
        "Madaripur": ["Madaripur Sadar (মাদারীপুর সদর)", "Kalkini (কালকিনি)", "Rajoir (রাজৈর)", "Shibchar (শিবচর)"],
        "Magura": ["Magura Sadar (মাগুরা সদর)", "Mohammadpur (মোহাম্মদপুর)", "Shalikha (শালিখা)", "Sreepur (শ্রীপুর)"],
        "Manikganj": ["Manikganj Sadar (মানিকগঞ্জ সদর)", "Singair (সিংগাইর)", "Shibalaya (শিবালয়)", "Saturia (সাটুরিয়া)"],
        "Meherpur": ["Meherpur Sadar (মেহেরপুর সদর)", "Gangni (গাংনী)", "Mujibnagar (মুজিবনগর)"],
        "Moulvibazar": ["Moulvibazar Sadar (মৌলভীবাজার সদর)", "Sreemangal (শ্রীমঙ্গল)", "Kulaura (কুলাউড়া)", "Barlekha (বড়লেখা)"],
        "Munshiganj": ["Munshiganj Sadar (মুন্সিগঞ্জ সদর)", "Sreenagar (শ্রীনগর)", "Lohajang (লৌহজং)", "Sirajdikhan (সিরাজদিখান)"],
        "Mymensingh": ["Mymensingh Sadar (ময়মনসিংহ সদর)", "Bhaluka (ভালুকা)", "Gafargaon (গফরগাঁও)", "Trishal (ত্রিশাল)", "Muktagacha (মুক্তাগাছা)"],
        "Naogaon": ["Naogaon Sadar (নওগাঁ সদর)", "Mohadevpur (মহাদেবপুর)", "Patnitala (পত্নীতলা)", "Sapahar (সাপাহার)"],
        "Narail": ["Narail Sadar (নড়াইল সদর)", "Lohagara (লোহাগড়া)", "Kalia (কালিয়া)"],
        "Narayanganj": ["Narayanganj Sadar (নারায়ণগঞ্জ সদর)", "Rupganj (রূপগঞ্জ)", "Sonargaon (সোনারগাঁও)", "Bandar (বন্দর)"],
        "Narsingdi": ["Narsingdi Sadar (নরসিংদী সদর)", "Madhabdi (মাধবদী)", "Palash (পলাশ)", "Raipura (রায়পুরা)"],
        "Natore": ["Natore Sadar (নাটোর সদর)", "Baraigram (বড়াইগ্রাম)", "Singra (সিংড়া)", "Gurudaspur (গুরুদাসপুর)"],
        "Netrokona": ["Netrokona Sadar (নেত্রকোনা সদর)", "Mohonganj (মোহনগঞ্জ)", "Durgapur (দুর্গাপুর)", "Kendua (কেন্দুয়া)"],
        "Nilphamari": ["Nilphamari Sadar (নীলফামারী সদর)", "Saidpur (সৈয়দপুর)", "Jaldhaka (জলঢাকা)", "Domar (ডোমার)"],
        "Noakhali": ["Noakhali Sadar (নোয়াখালী সদর)", "Begumganj (বেগমগঞ্জ)", "Companiganj (কোম্পানীগঞ্জ)", "Chatkhil (চাটখিল)"],
        "Pabna": ["Pabna Sadar (পাবনা সদর)", "Ishwardi (ঈশ্বরদী)", "Santhia (সাঁথিয়া)", "Chatmohar (চাটমোহর)"],
        "Panchagarh": ["Panchagarh Sadar (পঞ্চগড় সদর)", "Tetulia (তেঁতুলিয়া)", "Boda (বোদা)", "Debiganj (দেবীগঞ্জ)"],
        "Patuakhali": ["Patuakhali Sadar (পটুয়াখালী সদর)", "Kalapara (কুয়াকাটা)", "Bauphal (বাউফল)", "Galachipa (গলাচিপা)"],
        "Pirojpur": ["Pirojpur Sadar (পিরোজপুর সদর)", "Mathbaria (মঠবাড়িয়া)", "Bhandaria (ভাণ্ডারিয়া)", "Nesarabad (নেছারাবাদ)"],
        "Rajbari": ["Rajbari Sadar (রাজবাড়ী সদর)", "Goalandanda (গোয়ালন্দ)", "Pangsha (পাংশা)", "Baliakandi (বালিয়াকান্দি)"],
        "Rajshahi": ["Rajshahi City (রাজশাহী সিটি)", "Paba (পবা)", "Puthia (পুঠিয়া)", "Godagari (গোদাগাড়ী)", "Bagha (বাঘা)"],
        "Rangamati": ["Rangamati Sadar (রাঙ্গামাটি সদর)", "Kaptai (কাপ্তাই)", "Naniarchar (নানিয়ারচর)", "Langadu (লংগদু)"],
        "Rangpur": ["Rangpur City (রংপুর সিটি)", "Mithapukur (মিঠাপুকুর)", "Pirganj (পীরগঞ্জ)", "Badarganj (বদরগঞ্জ)"],
        "Satkhira": ["Satkhira Sadar (সাতক্ষীরা সদর)", "Shyamnagar (শ্যামনগর)", "Kaliganj (কালীগঞ্জ)", "Kalaroa (কলারোয়া)"],
        "Shariatpur": ["Shariatpur Sadar (শরীয়তপুর সদর)", "Naria (নড়িয়া)", "Zajira (জাজিরা)", "Bhedarganj (ভেদরগঞ্জ)"],
        "Sherpur": ["Sherpur Sadar (শেরপুর সদর)", "Nalitabari (নালিতাবাড়ী)", "Nakla (নকলা)", "Sreebardi (শ্রীবরদী)"],
        "Sirajganj": ["Sirajganj Sadar (সিরাজগঞ্জ সদর)", "Shahjadpur (শাহজাদপুর)", "Ullapara (উল্লাপাড়া)", "Belkuchi (বেলকুচি)"],
        "Sunamganj": ["Sunamganj Sadar (সুনামগঞ্জ সদর)", "Chhatak (ছাতক)", "Jagannathpur (জগন্নাথপুর)", "Dirai (দিরাই)"],
        "Sylhet": ["Sylhet City (সিলেট সিটি)", "Beanibazar (বিয়ানীবাজার)", "Golapganj (গোলাপগঞ্জ)", "Fenchuganj (ফেঞ্চুগঞ্জ)"],
        "Tangail": ["Tangail Sadar (টাঙ্গাইল সদর)", "Mirzapur (মির্জাপুর)", "Madhupur (মধুপুর)", "Gopalpur (গোপালপুর)"],
        "Thakurgaon": ["Thakurgaon Sadar (ঠাকুরগাঁও সদর)", "Pirganj (পীরগঞ্জ)", "Baliadangi (বালিয়াডাঙ্গী)", "Ranisankail (রাণীশংকৈল)"]
    };

    let currentUser = null;
    let productPrice = 0;
    let pName = "";
    let selectedMethod = "";

    const urlParams = new URLSearchParams(window.location.search);
    const pId = urlParams.get('id');
    const pSize = urlParams.get('size') || "N/A";
    document.getElementById('sumSize').innerText = pSize;

    // জেলা ড্রপডাউন লোড করা
    const distDropdown = document.getElementById('uDistrict');
    Object.keys(areaData).sort().forEach(dist => {
        let opt = document.createElement('option');
        opt.value = dist;
        opt.innerText = dist + " (" + dist + ")";
        distDropdown.appendChild(opt);
    });

    // জেলা পরিবর্তন হলে এরিয়া লোড হওয়া
    distDropdown.onchange = function() {
        const areaDropdown = document.getElementById('uAreaSelect');
        areaDropdown.innerHTML = '<option value="">এলাকা সিলেক্ট করুন</option>';
        const selectedDist = this.value;
        if(selectedDist && areaData[selectedDist]) {
            areaData[selectedDist].forEach(area => {
                let opt = document.createElement('option');
                opt.value = area;
                opt.innerText = area;
                areaDropdown.appendChild(opt);
            });
        }
    };

    // Firebase থেকে প্রোডাক্টের তথ্য ও ছবি আনা
    if(pId) {
        onValue(ref(db, 'products/' + pId), (snap) => {
            if(snap.exists()) {
                const data = snap.val();
                productPrice = parseInt(data.price);
                pName = data.name;
                document.getElementById('sumTitle').innerText = pName;
                document.getElementById('pPriceText').innerText = productPrice + " ৳";
                // ছবির জন্য 'img' বা 'image' কী (Key) চেক করা
                document.getElementById('sumImg').src = data.img || data.image || "https://via.placeholder.com/100";
                updateTotal();
            }
        });
    }

    // ডেলিভারি চার্জ হিসাব
    document.getElementById('uDeliveryArea').onchange = updateTotal;
    function updateTotal() {
        const charge = parseInt(document.getElementById('uDeliveryArea').value);
        document.getElementById('dChargeText').innerText = charge + " ৳";
        document.getElementById('totalAmount').innerText = (productPrice + charge) + " ৳";
    }

    // পেমেন্ট মেথড সিলেকশন
    document.getElementById('bkashBtn').onclick = () => setPayment('bKash', '017XXXXXXXX');
    document.getElementById('nagadBtn').onclick = () => setPayment('Nagad', '018XXXXXXXX');

    function setPayment(method, num) {
        selectedMethod = method;
        document.getElementById('numberDisplay').style.display = 'block';
        document.getElementById('trxID').style.display = 'block';
        document.getElementById('payNum').innerText = num;
        document.getElementById('methodLabel').innerText = method + " পার্সোনাল নম্বরে টাকা পাঠান:";
        document.getElementById('bkashBtn').classList.remove('selected');
        document.getElementById('nagadBtn').classList.remove('selected');
        document.getElementById(method.toLowerCase() + 'Btn').classList.add('selected');
    }

    // নম্বর কপি করার সুবিধা
    document.getElementById('payNum').onclick = function() {
        navigator.clipboard.writeText(this.innerText);
        alert("নম্বর কপি হয়েছে!");
    };

    // অর্ডার প্লেস করা
    document.getElementById('submitOrder').onclick = function() {
        const name = document.getElementById('uName').value;
        const phone = document.getElementById('uPhone').value;
        const dist = document.getElementById('uDistrict').value;
        const area = document.getElementById('uAreaSelect').value;
        const trx = document.getElementById('trxID').value;
        const fullAddr = document.getElementById('uFullAddress').value;

        if(!name || !phone || !dist || !area || !selectedMethod || !trx) {
            alert("অনুগ্রহ করে সব তথ্য এবং পেমেন্ট ট্রানজেকশন আইডি দিন!");
            return;
        }

        const orderRef = push(ref(db, 'orders'));
        set(orderRef, {
            userName: name,
            userPhone: phone,
            district: dist,
            area: area,
            address: fullAddr,
            productName: pName,
            productSize: pSize,
            totalAmount: document.getElementById('totalAmount').innerText,
            paymentMethod: selectedMethod,
            trxID: trx,
            status: "Pending",
            timestamp: Date.now()
        }).then(() => {
            alert("অর্ডার সফলভাবে গ্রহণ করা হয়েছে!");
            window.location.href = "my_orders.html"; 
        }).catch((error) => {
            alert("অর্ডার দিতে সমস্যা হয়েছে: " + error.message);
        });
    };

    onAuthStateChanged(auth, (user) => { if(user) currentUser = user; });
</script>

</body>
</html>

